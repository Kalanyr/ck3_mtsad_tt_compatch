namespace = mz_middle_east_decisions
# Events from the Jewish Priesthood decision redirect here to avoid overwriting vanilla events. Namespace is different but the events are the same.
mz_middle_east_decisions.0001 = {
	type = character_event
	title = middle_east_decisions.0007.t
	desc = middle_east_decisions.0007.desc
	theme = faith
	left_portrait = {
		character = scope:scoped_ruler
		animation = happiness
	}
	right_portrait = {
		character = scope:new_priest
		animation = personality_zealous
	}

	immediate = {
		play_music_cue = "mx_cue_faith_conversion"
		save_scope_as = scoped_ruler
		if = { # Check if Temporal first.
			limit = {
				faith = { has_doctrine = doctrine_temporal_head }
			}
			save_scope_as = new_priest
		}
		else_if = { # Pick your chaplain first.
			limit = {
				exists = cp:councillor_court_chaplain
				cp:councillor_court_chaplain = { faith = scope:scoped_ruler.faith }
			}
			if = {
				limit = {
					root.faith = { has_doctrine = doctrine_no_head }
				}
				hidden_effect = {
					root.faith = { remove_doctrine = doctrine_no_head }
					root.faith = { add_doctrine = doctrine_spiritual_head }
				}
			}
			cp:councillor_court_chaplain = { save_scope_as = new_priest }
		}
		else = {
			hidden_effect = {
				create_character = {
					employer = root
					template = religious_leader_character
					random_traits = no
					save_scope_as = new_priest
					dynasty = generate
				}
			}
			scope:new_priest = {
				add_trait = education_learning_3
				add_trait = zealous
				add_trait = intellect_good_1
				random_list = {
					1 = { add_trait = lustful }
					1 = { add_trait = chaste }
					1 = { add_trait = wrathful }
					1 = { add_trait = diligent }
					1 = { add_trait = impatient }
					1 = { add_trait = arrogant }
					1 = { add_trait = humble }
					1 = { add_trait = gregarious }
				}
				random_list = {
					1 = { add_trait = honest }
					1 = { add_trait = ambitious }
					1 = { add_trait = just }
					1 = { add_trait = cynical }
					1 = { add_trait = zealous }
					1 = { add_trait = compassionate }
					1 = { add_trait = stubborn }
				}
			}
		}

		custom_description = {
			text = "new_religious_head_title"
			object = scope:new_priest
			subject = scope:new_priest

			set_up_dynamic_spiritual_hof_title_existing_hof_effect = {
				CREATOR = scope:scoped_ruler
				RELIGIOUS_HEAD = scope:new_priest
			}
		}
	}

	option = {
		name = middle_east_decisions.0007.a
		add_prestige = major_prestige_gain
		add_piety = major_piety_gain
		faith = {
			change_fervor = {
				value = 100
				desc = fervor_gain_priesthood_recreated
			}
		}
		if = { # Vassalize if possible/needed.
			limit = {
				highest_held_title_tier > scope:new_priest.highest_held_title_tier
				NOT = { scope:new_priest = { any_liege_or_above = { this = root } } }
			}
			create_title_and_vassal_change = {
				type = created
				save_scope_as = change
				add_claim_on_loss = no
			}
			scope:new_priest = {
				change_liege = {
					liege = root
					change = scope:change
				}
			}
			resolve_title_and_vassal_change = scope:change
		}
		hidden_effect = {
			if = {
				limit = { root = { has_faith = faith:kabarism } }
				trigger_event = {
					id = mz_religious_decision.0001
					days = 360
				}
			}
			every_player = {
				limit = {
					NOT = { this = root }
					OR = {
						faith = root.faith
						AND = {
							is_landed = yes
							capital_province = {
								OR = {
									geographical_region = world_middle_east
									geographical_region = world_persian_empire
								}
							}
						}
					}
				}
				trigger_event = middle_east_decisions.0008
			}
		}
	}
}

